!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,r){"use strict";r.r(t),r.d(t,"COPYRIGHT_YEAR",function(){return n}),r.d(t,"FULLTITLE",function(){return a}),r.d(t,"LONG_NAME",function(){return i}),r.d(t,"NAME",function(){return o}),r.d(t,"ORGANIZATION",function(){return s}),r.d(t,"VERSION",function(){return u}),r.d(t,"events",function(){return c}),r.d(t,"log",function(){return d}),r.d(t,"on",function(){return l}),r.d(t,"trigger",function(){return p});const n=(new Date).getFullYear(),a="ES-DOC Dataset Errata",i="Dataset Errata",o="Errata",s="ES-DOC",u="0.6.4.0",c=_.extend({},Backbone.Events),d=e=>{console.log(new Date+" :: "+s+"-"+o.toUpperCase()+" :: "+e)},l=(e,t,r)=>{c.on(e,t,r)},p=(e,t)=>(d("event :: "+e),c.trigger(e,t))},function(e,t,r){"use strict";r.r(t),r.d(t,"openURL",function(){return i}),r.d(t,"openDocumentation",function(){return o}),r.d(t,"openPIDDocumentation",function(){return s}),r.d(t,"openHomepage",function(){return u}),r.d(t,"openEmail",function(){return c}),r.d(t,"openSupportEmail",function(){return d}),r.d(t,"render",function(){return l}),r.d(t,"renderHTML",function(){return p}),r.d(t,"renderTemplate",function(){return f}),r.d(t,"getURLParam",function(){return h}),r.d(t,"getPageCount",function(){return E}),r.d(t,"getPages",function(){return m}),r.d(t,"displayFeedback",function(){return S}),r.d(t,"hideFeedback",function(){return U}),r.d(t,"displayInfoDialog",function(){return D}),r.d(t,"hideInfoDialog",function(){return v}),r.d(t,"generateUUID",function(){return A});var n=r(0),a=r(2);const i=(e,t)=>{!0===t?window.open(e):window.location=e},o=()=>{i(a.URLS.DOCUMENTATION,!0)},s=()=>{i(a.URLS.PIDDOCUMENTATION,!0)},u=()=>{i(a.URLS.HOME_PAGE,!0)},c=(e,t,r)=>{var n="mailto:{0}?subject={1}&body={2}";t=t||a.EMAIL.SUBJECT,r=r||a.EMAIL.MESSAGE,n=(n=(n=n.replace("{0}",e)).replace("{1}",t)).replace("{2}",r),window.location.href=n},d=()=>{var e;e=(e=(e="ES-DOC :: SUPPORT :: {0} (v{1})").replace("{0}",n.NAME.toUpperCase())).replace("{1}",n.VERSION),c(a.EMAIL.SUPPORT,e)},l=(e,t,r)=>{var n,a,i=[];return n=_.isArray(e)?e:[e],_.each(n,function(e){a=new e(t).render(),i.push(a),_.isUndefined(r)||(_.has(r,"$el")?r.$el.append(a.$el):r.append(a.$el))},void 0),1===n.length?i[0]:i},p=(e,t,r)=>{var n=t?e(t):e();_.isUndefined(r)||(_.has(r,"$el")?r.$el.append(n):r.append(n))},g={},f=(e,t,r)=>{var n;if(_.has(g,e)||(g[e]=_.template($("#"+e).html())),n=(0,g[e])(t),r&&r.$el)r.$el.append(n);else{if(!r)return n;r.replaceWith(n)}},h=(e,t)=>{var r=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return r?(r[1]||t).toUpperCase():t},E=function(e,t){var r=0;return t&&t/e>(r=parseInt(t/e,10))&&(r+=1),r},m=(e,t)=>_.map(_.range(E(e,t.length)),function(t){return{id:t+1,data:this.slice(t*e,(t+1)*e-1)}},t),S=e=>{$("#feedbackText").text(e+" ... please wait"),$(".feedback-title").text(n.FULLTITLE),$(".feedback-version").text("v"+n.VERSION),$("#feedbackContainer").modal({backdrop:"static",keyboard:!1,show:!0})},U=()=>{$("#feedbackContainer").modal("hide")},D=(e,t)=>{$("#infoDialogText").text(e),$(".infoDialog-title").text(n.FULLTITLE),$(".infoDialog-version").text("v"+n.VERSION),t&&$("#infoDialogContainer").on("hide.bs.modal",t),$("#infoDialogContainer").modal({backdrop:"static",keyboard:!1,show:!0})},v=()=>{$("#infoDialog").modal("hide")},A=()=>{let e=(new Date).getTime();return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)})}},function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"CONTACT",function(){return o}),r.d(n,"SUPPORT",function(){return s}),r.d(n,"SUBJECT",function(){return u}),r.d(n,"MESSAGE",function(){return c});var a={};r.r(a),r.d(a,"LOGGING_PREFIX",function(){return d}),r.d(a,"NULL_FIELD",function(){return l}),r.d(a,"UI_UPDATE_DELAY",function(){return p});var i={};r.r(i),r.d(i,"API_BASE_URL",function(){return g}),r.d(i,"DOCUMENTATION",function(){return f}),r.d(i,"PIDDOCUMENTATION",function(){return h}),r.d(i,"HOME_PAGE",function(){return _}),r.d(i,"OAUTH_AUTHORIZE",function(){return E}),r.d(i,"PID_PAGE",function(){return m}),r.d(i,"PID_RESOLVE",function(){return S}),r.d(i,"PID_TASK_QUEUE_SEARCH",function(){return U}),r.d(i,"PID_TASK_QUEUE_SEARCH_SETUP",function(){return D}),r.d(i,"ISSUE_CREATE",function(){return v}),r.d(i,"ISSUE_UPDATE",function(){return A}),r.d(i,"RETRIEVE",function(){return T}),r.d(i,"SEARCH",function(){return y}),r.d(i,"SEARCH_SETUP",function(){return I}),r.d(i,"SEARCH_PAGE",function(){return P}),r.d(i,"VIEW_PAGE",function(){return C}),r.d(i,"EDIT_PAGE",function(){return x});const o="support@errata.es-doc.org",s="support@errata.es-doc.org",u="ES-DOC ERRATA :: subject goes here",c="Dear ES-DOC ERRATA support team,",d="ES-DOC-ERRATA :: ",l="--",p=1e3,g=window.origin,f="https://es-doc.github.io/esdoc-errata-client/",h="https://es-doc.github.io/esdoc-errata-client/lookup.html",_="https://es-doc.org",E=window.location.origin+"/oauth/authorize",m="pid.html",S="/1/resolve/pid",U="/1/pid-queue/search",D="/1/pid-queue/search-setup",v="/1/issue/create",A="/1/issue/update",T="/1/issue/retrieve",y="/1/issue/search",I="/1/issue/search-setup",P="/static/index.html",C="/static/view.html",x="/static/edit.html";r.d(t,"EMAIL",function(){return b}),r.d(t,"MISC",function(){return k}),r.d(t,"URLS",function(){return w});const b=n,k=a,w=i},,,function(e,t,r){"use strict";r.r(t);var n={};r.r(n),r.d(n,"filters",function(){return u}),r.d(n,"paging",function(){return c}),r.d(n,"sorting",function(){return d}),r.d(n,"searchData",function(){return l}),r.d(n,"setSearchData",function(){return p}),r.d(n,"initFilters",function(){return g}),r.d(n,"updateFilter",function(){return f}),r.d(n,"paginateIssues",function(){return h}),r.d(n,"sortResults",function(){return E}),r.d(n,"updateSortField",function(){return m});var a=r(0),i=r(1),o=r(2);class s{constructor(e){this.action=u[1].data.set["esdoc:errata:pid-task-action:"+e.action],this.status=u[2].data.set["esdoc:errata:pid-task-status:"+e.status]}}var u=[];const c={current:null,count:0,pages:[],pageSize:25,pageSizeOptions:[25,50,100]},d={field:"timestamp",direction:"desc"};var l=null;const p=e=>{l=_.defaults({results:_.map(e.results,e=>new class{constructor(e){_.each(_.keys(e),t=>{this[t]=e[t]}),this.ext=new s(this)}}(e,u))},e),E(),h()},g=e=>{u=_.map(e,function(e){return new class{constructor(e){var t;this.data={all:_.sortBy(e.terms,e=>e.sortOrdinal||e.key),current:null,set:{}},this.key=e.key,this.label=e.label,this.uiPosition="esdoc:errata:project"===e.key?0:"esdoc:errata:pid-task-action"===e.key?1e3:"esdoc:errata:pid-task-status"===e.key?1001:100,"esdoc:errata:project"!=e.key&&this.data.all.unshift({key:e.key+":*",label:"*",namespace:e.key+":*"}),(t="esdoc:errata:project"===e.key?"esdoc:errata:project:cmip6":null)&&(this.data.current=_.find(this.data.all,e=>e.key===t)),this.data.current=this.data.current||this.data.all[0],this.data.set=_.indexBy(this.data.all,"key")}}(e)})},f=(e,t)=>{var r;(r=_.find(u,t=>t.key===e)).data.current=_.find(r.data.all,e=>e.key===t),APP.trigger("state:filterUpdated",r)},h=()=>{c.pages=i.getPages(c.pageSize,l.results),c.count=c.pages.length,c.current=c.count>0?c.pages[0]:void 0},E=()=>{var e,t,r;"datasetID"===(t=d.field)?r=(e=>e.datasetID):"status"===t?r=(e=>e.ext.status.label.toLowerCase()):"action"===t?r=(e=>e.ext.action.label.toLowerCase()):"timestamp"===t&&(r=(e=>e[t]?e[t].valueOf():"--")),e=_.sortBy(l.results,r),"desc"===d.direction&&(e=e.reverse()),l.results=e},m=e=>{d.field===e?(d.direction="asc"===d.direction?"desc":"asc",APP.trigger("state:sortDirectionToggled")):(APP.trigger("state:sortFieldChanging"),d.field=e,d.direction="timestamp"===e?"desc":"asc",APP.trigger("state:sortFieldChanged")),E(),h()};var S=Backbone.View.extend({events:{"click img.esdoc-logo":()=>{i.openHomepage()},"click button.esdoc-support":()=>{i.openSupportEmail()},"click button.esdoc-docs":()=>{i.openDocumentation()},"click .task":e=>{var t;t=o.URLS.VIEW_PAGE,t+="?uid=",t+=$(e.target).parent().attr("id")||$(e.target).parent().parent().attr("id"),i.openURL(t,!0)},"change .filter select":e=>{a.trigger("state:filterUpdate",$(e.target).val())},"change .pagination-info":e=>{var t;t=parseInt($(e.target).val(),10),$(e.target).val(""),!1===_.isNaN(t)&&t>0&&t<=c.pages.length&&c.current!==c.pages[t-1]&&(c.current=c.pages[t-1],a.trigger("state:pageUpdate"))},"click .pagination-first":()=>{c.pages.length&&c.current!==_.first(c.pages)&&(c.current=_.first(c.pages),a.trigger("state:pageUpdate"))},"click .pagination-previous":()=>{c.pages.length&&c.current!==_.first(c.pages)&&(c.current=c.pages[c.current.id-2],a.trigger("state:pageUpdate"))},"click .pagination-next":()=>{c.pages.length&&c.current!==_.last(c.pages)&&(c.current=c.pages[c.current.id],a.trigger("state:pageUpdate"))},"click .pagination-last":()=>{c.pages.length&&c.current!==_.last(c.pages)&&(c.current=_.last(c.pages),a.trigger("state:pageUpdate"))},"change .pagination-page-size":e=>{c.pageSize=$(e.target).val(),c.pages=i.getPages(c.pageSize,l.results),c.count=c.pages.length,c.current=c.count>0?c.pages[0]:void 0,a.trigger("state:pageUpdate")},"click .sort-target":e=>{var t;(t=$(e.target).attr("class"))&&(t=t.split(" "),t=(t=_.find(t,e=>e.startsWith("sort-target-"))).slice(12)),t&&(m(t),a.trigger("state:pageUpdate"))}},initialize:function(){a.events.on("ui:initialized",this._setSortColumn,this),a.events.on("search:complete",this._updateStatisticsInfo,this),a.events.on("state:pageUpdate",this._updateGrid,this),a.events.on("state:pageUpdate",this._updateGridPager,this),a.events.on("state:sortFieldChanging",this._clearSortColumn,this),a.events.on("state:sortFieldChanged",this._setSortColumn,this),a.events.on("state:sortDirectionToggled",this._toggleSortColumn,this),a.events.on("project:changed",()=>{this._replaceNode("div.filter","template-filter")},this)},render:function(){return _.each(["template-header","template-filter","template-grid"],e=>{i.renderTemplate(e,a,this)},this),this},_setSortColumn:function(){"asc"===d.direction?this.$(".glyphicon.sort-target-"+d.field).addClass("glyphicon-menu-up"):this.$(".glyphicon.sort-target-"+d.field).addClass("glyphicon-menu-down")},_toggleSortColumn:function(){this._clearSortColumn(),this._setSortColumn()},_clearSortColumn:function(){this.$(".glyphicon.sort-target-"+d.field).removeClass("glyphicon-menu-up"),this.$(".glyphicon.sort-target-"+d.field).removeClass("glyphicon-menu-down")},_updateGrid:function(){this._replaceNode("tbody","template-grid-body")},_updateGridPager:function(){var e;e="Page ",e+=c.current?c.current.id:"0",e+=" of ",e+=c.count,this.$(".pagination-info").attr("placeholder",e),this.$(".pagination-container").removeClass("hidden"),c.count<2&&l.count<25&&this.$(".pagination-container").addClass("hidden")},_updateStatisticsInfo:function(){this._replaceNode("#grid-header-summary","template-grid-header-summary"),this._replaceNode("#grid-footer-summary","template-grid-footer-summary")},_replaceNode:function(e,t){this.$(e).replaceWith(i.renderTemplate(t,n))}});a.on("setup:begin",()=>{var e;e=o.URLS.API_BASE_URL+o.URLS.PID_TASK_QUEUE_SEARCH_SETUP,$.get(e).done(e=>{a.trigger("setup:setupDataDownload",e)}).fail(()=>{setTimeout(()=>{a.trigger("setup:setupDataDownload:error")},o.MISC.UI_UPDATE_DELAY)})}),a.on("setup:setupDataDownload",e=>{g(e.vocabs),U(null,"setup:initialSearchDataDownload")}),a.on("state:filterUpdated",e=>{U("search:begin","search:dataDownload")}),a.on("state:filterUpdate",e=>{f(e.split(":").slice(0,3).join(":"),e)});const U=(e,t)=>{var r,n;!1===_.isNull(e)&&a.trigger(e),r=o.URLS.API_BASE_URL+o.URLS.PID_TASK_QUEUE_SEARCH,n=[],_.each(_.values(u),e=>{!1===e.data.current.key.endsWith("*")&&n.push(e.data.current.key)}),n={criteria:n.join(",")},a.trigger(t+"ing"),$.get(r,n).done(e=>{setTimeout(()=>{a.trigger(t,e)},o.MISC.UI_UPDATE_DELAY)}).fail(()=>{setTimeout(()=>{a.trigger(t+":error")},o.MISC.UI_UPDATE_DELAY)})};a.on("setup:initialSearchDataDownload",e=>{p(e),a.trigger("setup:complete")}),a.on("search:dataDownload",e=>{p(e),a.trigger("state:pageUpdate"),a.trigger("search:complete")}),a.on("setup:begin",()=>{i.displayFeedback("Initializing errata pid task search")}),a.on("setup:complete",i.hideFeedback),a.on("setup:setupDataDownload:error",()=>{alert("setup:setupDataDownload:error")}),a.on("search:begin",()=>{i.displayFeedback("Searching errata repository")}),a.on("search:complete",i.hideFeedback),a.on("search:dataDownload:error",()=>{alert("search:dataDownload:error")}),$(document).ready(()=>{a.trigger("setup:begin")}),a.events.on("setup:complete",()=>{var e;(e=new S).render(),$("body").append(e.el),a.log("ui initialized"),a.trigger("ui:initialized")}),window.APP=a,window.STATE=n,window.UTILS=i,window.CONSTANTS=o}]);