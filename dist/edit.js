!function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=7)}([function(t,e,s){"use strict";s.r(e),s.d(e,"COPYRIGHT_YEAR",function(){return i}),s.d(e,"FULLTITLE",function(){return r}),s.d(e,"LONG_NAME",function(){return n}),s.d(e,"NAME",function(){return o}),s.d(e,"ORGANIZATION",function(){return a}),s.d(e,"VERSION",function(){return u}),s.d(e,"events",function(){return c}),s.d(e,"log",function(){return d}),s.d(e,"on",function(){return l}),s.d(e,"trigger",function(){return p});const i=(new Date).getFullYear(),r="ES-DOC Dataset Errata",n="Dataset Errata",o="Errata",a="ES-DOC",u="0.5.3.0",c=_.extend({},Backbone.Events),d=t=>{console.log(new Date+" :: "+a+"-"+o.toUpperCase()+" :: "+t)},l=(t,e,s)=>{c.on(t,e,s)},p=(t,e)=>(d("event :: "+t),c.trigger(t,e))},function(t,e,s){"use strict";s.r(e),s.d(e,"openURL",function(){return n}),s.d(e,"openHomepage",function(){return o}),s.d(e,"openEmail",function(){return a}),s.d(e,"openSupportEmail",function(){return u}),s.d(e,"render",function(){return c}),s.d(e,"renderHTML",function(){return d}),s.d(e,"renderTemplate",function(){return p}),s.d(e,"getURLParam",function(){return h}),s.d(e,"getPageCount",function(){return g}),s.d(e,"getPages",function(){return f}),s.d(e,"displayFeedback",function(){return S}),s.d(e,"hideFeedback",function(){return m}),s.d(e,"displayInfoDialog",function(){return E}),s.d(e,"hideInfoDialog",function(){return v}),s.d(e,"generateUUID",function(){return T});var i=s(0),r=s(2);const n=(t,e)=>{!0===e?window.open(t):window.location=t},o=()=>{n(r.URLS.HOME_PAGE,!0)},a=(t,e,s)=>{var i="mailto:{0}?subject={1}&body={2}";e=e||r.EMAIL.SUBJECT,s=s||r.EMAIL.MESSAGE,i=(i=(i=i.replace("{0}",t)).replace("{1}",e)).replace("{2}",s),window.location.href=i},u=()=>{var t;t=(t=(t="ES-DOC :: SUPPORT :: {0} (v{1})").replace("{0}",i.NAME.toUpperCase())).replace("{1}",i.VERSION),a(r.EMAIL.SUPPORT,t)},c=(t,e,s)=>{var i,r,n=[];return i=_.isArray(t)?t:[t],_.each(i,function(t){r=new t(e).render(),n.push(r),_.isUndefined(s)||(_.has(s,"$el")?s.$el.append(r.$el):s.append(r.$el))},void 0),1===i.length?n[0]:n},d=(t,e,s)=>{var i=e?t(e):t();_.isUndefined(s)||(_.has(s,"$el")?s.$el.append(i):s.append(i))},l={},p=(t,e,s)=>{var i;if(_.has(l,t)||(l[t]=_.template($("#"+t).html())),i=(0,l[t])(e),s&&s.$el)s.$el.append(i);else{if(!s)return i;s.replaceWith(i)}},h=(t,e)=>{var s=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.href);return s?(s[1]||e).toUpperCase():e},g=function(t,e){var s=0;return e&&e/t>(s=parseInt(e/t,10))&&(s+=1),s},f=(t,e)=>_.map(_.range(g(t,e.length)),function(e){return{id:e+1,data:this.slice(e*t,(e+1)*t-1)}},e),S=t=>{$("#feedbackText").text(t+" ... please wait"),$(".feedback-title").text(i.FULLTITLE),$(".feedback-version").text("v"+i.VERSION),$("#feedbackContainer").modal({backdrop:"static",keyboard:!1,show:!0})},m=()=>{$("#feedbackContainer").modal("hide")},E=(t,e)=>{$("#infoDialogText").text(t),$(".infoDialog-title").text(i.FULLTITLE),$(".infoDialog-version").text("v"+i.VERSION),e&&$("#infoDialogContainer").on("hide.bs.modal",e),$("#infoDialogContainer").modal({backdrop:"static",keyboard:!1,show:!0})},v=()=>{$("#infoDialog").modal("hide")},T=()=>{let t=(new Date).getTime();return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const s=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?s:3&s|8).toString(16)})}},function(t,e,s){"use strict";s.r(e);var i={};s.d(i,"CONTACT",function(){return o}),s.d(i,"SUPPORT",function(){return a}),s.d(i,"SUBJECT",function(){return u}),s.d(i,"MESSAGE",function(){return c});var r={};s.d(r,"LOGGING_PREFIX",function(){return d}),s.d(r,"NULL_FIELD",function(){return l}),s.d(r,"UI_UPDATE_DELAY",function(){return p});var n={};s.d(n,"API_BASE_URL",function(){return h}),s.d(n,"HOME_PAGE",function(){return g}),s.d(n,"OAUTH_AUTHORIZE",function(){return f}),s.d(n,"PID_PAGE",function(){return S}),s.d(n,"PID_RESOLVE",function(){return m}),s.d(n,"PID_TASK_QUEUE_SEARCH",function(){return E}),s.d(n,"PID_TASK_QUEUE_SEARCH_SETUP",function(){return v}),s.d(n,"ISSUE_CREATE",function(){return T}),s.d(n,"ISSUE_UPDATE",function(){return w}),s.d(n,"RETRIEVE",function(){return _}),s.d(n,"SEARCH",function(){return x}),s.d(n,"SEARCH_SETUP",function(){return A}),s.d(n,"SEARCH_PAGE",function(){return C}),s.d(n,"VIEW_PAGE",function(){return U}),s.d(n,"EDIT_PAGE",function(){return I});const o="errata-contact@list.woc.noaa.gov",a="errata-support@list.woc.noaa.gov",u="ES-DOC ERRATA :: subject goes here",c="Dear ES-DOC ERRATA support team,",d="ES-DOC-ERRATA :: ",l="--",p=1e3,h=window.origin,g="https://es-doc.org",f=window.location.origin+"/oauth/authorize",S="pid.html",m="/1/resolve/pid",E="/1/pid-queue/search",v="/1/pid-queue/search-setup",T="/1/issue/create",w="/1/issue/update",_="/1/issue/retrieve",x="/1/issue/search",A="/1/issue/search-setup",C="/static/index.html",U="/static/view.html",I="/static/edit.html";s.d(e,"EMAIL",function(){return D}),s.d(e,"MISC",function(){return P}),s.d(e,"URLS",function(){return R});const D=i,P=r,R=n},,,,,function(t,e,s){"use strict";s.r(e);var i={};s.d(i,"WCRP",function(){return g}),s.d(i,"ESDOC",function(){return f}),s.d(i,"initialise",function(){return S});var r={};s.d(r,"OAuthCredentials",function(){return m}),s.d(r,"isAuthenticated",function(){return E}),s.d(r,"issue",function(){return v});var n=s(0),o=s(1),a=s(2);class u{constructor(t){_.each(_.keys(t),e=>{this[e]=t[e]})}}class c extends u{constructor(t){super(t),this.scopes=_.map(t.scopes,e=>new d(t,e))}getScope(t){return _.find(this.scopes,e=>e.canonicalName.toLowerCase()===t.toLowerCase())}}class d extends u{constructor(t,e){super(e),this.authority=t,this.collections=_.map(e.collections,s=>new l(t,e,s))}getCollection(t){return _.find(this.collections,e=>e.canonicalName.toLowerCase()===t.toLowerCase())}getTerms(t){let e=this.getCollection(t);if(e)return _.sortBy(e.terms,t=>_.has(t.data,"sortOrdinal")?t.data.sortOrdinal:t.canonicalName)}getTerm(t,e){let s=this.getCollection(t);if(s)return s.getTerm(e)}}class l extends u{constructor(t,e,s){super(s),this.authority=t,this.scope=e,this.terms=_.map(s.terms,i=>new p(t,e,s,i))}getTerm(t){return _.find(this.terms,e=>e.canonicalName.toLowerCase()===t.toLowerCase())}}class p extends u{constructor(t,e,s,i){super(i),this.authority=t,this.scope=e,this.collection=s}isMatch(t){return this.canonicalName===t}}const h={dev:"http://localhost:5010",test:"https://test-api-pyessv.es-doc.org",prod:"https://api-pyessv.es-doc.org"}[(()=>window.location.host&&window.location.host.indexOf("es-doc.org")>=0?window.location.host.indexOf("test")>=0?"test":"prod":"dev")()]+"/1/retrieve";let g=null,f=null;const S=(t,e)=>{$.get(h).done(e=>{_.each(e.data,t=>{switch(t.canonicalName){case"wcrp":g=new class extends c{constructor(t){super(t),this.CMIP5=new class extends d{constructor(t,e){super(t,e)}}(t,this.getScope("cmip5")),this.CMIP6=new class extends d{constructor(t,e){super(t,e)}getActivity(t){return this.getTerm("activity-id",t)}getExperiment(t){return this.getTerm("experiment-id",t)}getInstitution(t){return this.getTerm("institution-id",t)}getSource(t){return this.getTerm("source-id",t)}}(t,this.getScope("cmip6")),this.CORDEX=new class extends d{constructor(t,e){super(t,e)}}(t,this.getScope("cordex")),this.GLOBAL=new class extends d{constructor(t,e){super(t,e)}getMipEra(t){return this.getTerm("mip-era",t)}}(t,this.getScope("global"))}}(t);break;case"esdoc":f=new class extends c{constructor(t){super(t),this.CMIP6=new class extends d{constructor(t,e){super(t,e)}getModelTopicAction(t){return this.getTerm("model-topic",t)}getModelTopicCollection(){return this.getCollection("model-topic")}}(t,this.getScope("cmip6")),this.ERRATA=new class extends d{constructor(t,e){super(t,e)}getPidTaskAction(t){return this.getTerm("pid-task-action",t)}getPidTaskActionCollection(){return this.getCollection("pid-task-action")}getPidTaskStatus(t){return this.getTerm("pid-task-status",t)}getPidTaskStatusCollection(){return this.getCollection("pid-task-status")}getProject(t){return this.getTerm("project",t)}getProjectTerms(){return this.getTerms("project")}getSeverity(t){return this.getTerm("severity",t)}getSeverityTerms(){return this.getTerms("severity")}getStatus(t){return this.getTerm("status",t)}getStatusTerms(){return this.getTerms("status")}}(t,this.getScope("errata"))}}(t)}}),t()}).fail(()=>{e()})};const m=Cookies.get("errata-oauth-credentials"),E=!1===_.isUndefined(m),v=new class{constructor(t){this.datasets=[],this.description=null,this.isNew=!t,this.materials=[],this.project=null,this.severity="low",this.status="new",this.title=null,this.uid=t||o.generateUUID(),this.urls=[],this.ext=new class{constructor(t){this._issue=t}get datasets(){return this._issue.datasets.join("\n")}get materials(){return this._issue.materials.join("\n")}}(this),this.previousState=null}get fullTitle(){var t;return this.isNew?"New Issue":(t=this.project.toUpperCase(),t+=" - ",t+=this.title.slice(0,48),this.title.length>48&&(t+="..."),t)}get hasChanged(){return null===this.previousState||this.datasets!=this.previousState.datasets||this.description!=this.previousState.description||this.materials!=this.previousState.materials||this.project!=this.previousState.project||this.severity!=this.previousState.severity||this.status!=this.previousState.status||this.title!=this.previousState.title||this.urls!=this.previousState.urls}decode(t){this.datasets=t.datasets,this.description=t.description,this.materials=t.materials,this.project=t.project,this.severity=t.severity,this.status=t.status,this.title=t.title,this.uid=t.uid,this.urls=t.urls,this.previousState=t}encode(){return JSON.stringify({datasets:this.datasets,description:this.description,materials:this.materials,project:this.project,severity:this.severity,status:this.status,title:this.title,uid:this.uid,urls:this.urls})}}(o.getURLParam("uid"));var T=Backbone.View.extend({events:{"click img.esdoc-logo":()=>{o.openHomepage()},"click button.esdoc-support":()=>{o.openSupportEmail()},"click button.esdoc-errata-save":()=>{v.hasChanged&&n.trigger("issue:save")},"change #issueDatasets":function(t){v.datasets=_.uniq(_.map(this.$("#issueDatasets").val().split("\n"),t=>t.trim()))},"change #issueDescription":function(t){v.description=this.$("#issueDescription").val()},"change #issueMaterials":function(t){v.materials=_.uniq(_.map(this.$("#issueMaterials").val().split("\n"),t=>t.trim()))},"change #issueProject":function(t){const e=this.$("#issueProject").val();"null"!==e&&(v.project=e)},"change #issueSeverity":function(t){v.severity=this.$("#issueSeverity").val()},"change #issueStatus":function(t){v.status=this.$("#issueStatus").val()},"change #issueTitle":function(t){v.title=this.$("#issueTitle").val()}},render:function(){return o.renderTemplate("template-header",null,this),o.renderTemplate("template-issue",null,this),this}});n.on("setup:begin",()=>{var t,e;v.isNew?n.trigger("setup:complete"):(t=a.URLS.API_BASE_URL+a.URLS.RETRIEVE,e={uid:v.uid},$.get(t,e).done(t=>{setTimeout(()=>{n.trigger("setup:issueDownload",t)},a.MISC.UI_UPDATE_DELAY)}).fail(()=>{setTimeout(()=>{n.trigger("setup:issueDownload:error")},a.MISC.UI_UPDATE_DELAY)}))}),n.on("setup:issueDownload",t=>{v.decode(t.issue),n.trigger("setup:complete")}),n.on("setup:issueDownload:error",t=>{alert("TODO: handle issue download error")}),n.on("setup:begin",()=>{o.displayFeedback("Initializing errata editor")}),n.on("ui:initialized",o.hideFeedback),n.on("setup:setupDataDownload:error",()=>{alert("TODO: setup:setupDataDownload:error")}),n.on("issue:save:posting",()=>{o.displayFeedback("Saving issue details")}),n.on("issue:save:post:success",()=>{o.hideFeedback(),o.displayInfoDialog("Issue details have been successfully saved.",()=>{n.trigger("issue:save:complete")})}),n.on("issue:save:error",()=>{o.hideFeedback(),o.displayInfoDialog("An error occurred whilst saving the issue details - please try again.  If the problem persists then contact support.")}),n.on("issue:save:confirmed",()=>{const t=CONSTANTS.URLS.API_BASE_URL+(v.isNew?CONSTANTS.URLS.ISSUE_CREATE:CONSTANTS.URLS.ISSUE_UPDATE);n.trigger("issue:save:posting"),$.ajax({method:"POST",url:t,data:v.encode(),dataType:"json",headers:{Authorization:m,"Content-Type":"application/json; charset=UTF-8","X-XSRFToken":Cookies.get("_xsrf")}}).always(t=>{200===t.status?n.trigger("issue:save:post:success"):n.trigger("issue:save:error",t)})}),n.on("issue:save",()=>{n.trigger("issue:save:confirmed")}),$(document).ready(()=>{S(()=>{n.trigger("setup:begin")})}),n.on("setup:complete",()=>{var t;(t=new T).render(),$("body").append(t.el),n.trigger("ui:initialized")}),n.on("issue:save:complete",()=>{let t=a.URLS.VIEW_PAGE;t+="?uid=",t+=v.uid,o.openURL(t)}),window.APP=n,window.CONSTANTS=a,window.PYESSV=i,window.STATE=r,window.UTILS=o}]);